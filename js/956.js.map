{"version":3,"file":"956.js","mappings":"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","sources":["webpack://sakurairo-scripts/webpack/runtime/chunk loaded","webpack://sakurairo-scripts/webpack/runtime/startup chunk dependencies","webpack://sakurairo-scripts/./node_modules/.pnpm/@kotorik+palette@2.1.0/node_modules/@kotorik/palette/dist/index.modern.js","webpack://sakurairo-scripts/./src/app/theme-color/worker.ts","webpack://sakurairo-scripts/./node_modules/.pnpm/promise-worker@2.0.1/node_modules/promise-worker/register.js","webpack://sakurairo-scripts/./node_modules/.pnpm/neuquant-js@git+https+++git@github.com+KotoriK+neuquant-js.git\u0000#623a740dde09df93e23ff76f0e97ec_47ehpvkryyk2ycwzqnfknkmf4i/node_modules/neuquant-js/src/helpers.js","webpack://sakurairo-scripts/webpack/bootstrap","webpack://sakurairo-scripts/webpack/runtime/compat get default export","webpack://sakurairo-scripts/webpack/runtime/define property getters","webpack://sakurairo-scripts/webpack/runtime/ensure chunk","webpack://sakurairo-scripts/webpack/runtime/get javascript chunk filename","webpack://sakurairo-scripts/webpack/runtime/get mini-css chunk filename","webpack://sakurairo-scripts/webpack/runtime/global","webpack://sakurairo-scripts/webpack/runtime/hasOwnProperty shorthand","webpack://sakurairo-scripts/webpack/runtime/publicPath","webpack://sakurairo-scripts/webpack/runtime/importScripts chunk loading","webpack://sakurairo-scripts/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([\n\t\t__webpack_require__.e(4949),\n\t\t__webpack_require__.e(1176)\n\t]).then(next);\n};","import { palette, indexed } from 'neuquant-js';\nimport rgb from 'color-space/rgb.js';\nimport xyz from 'color-space/xyz.js';\nimport lab from 'color-space/lab.js';\n\n/**\r\n * 返回两个四维坐标间的欧几里得距离\r\n * @param a\r\n * @param b\r\n * @returns\r\n */\nfunction euclidean_distance_squared(a, b) {\n  const r = a[0] - b[0];\n  const g = a[1] - b[1];\n\n  const _b = a[2] - b[2];\n\n  const _a = a[3] - b[3];\n\n  return r ** 2 + g ** 2 + _b ** 2 + _a ** 2;\n}\nfunction euclidean_distance_squared_index(a, a_start, b) {\n  const r = a[a_start++] - b[0];\n  const g = a[a_start++] - b[1];\n\n  const _b = a[a_start++] - b[2];\n\n  const _a = a[a_start++] - b[3];\n\n  return r ** 2 + g ** 2 + _b ** 2 + _a ** 2;\n}\n/**\r\n * 以数组形式返回三个数字中的最大值与最小值\r\n * @param param0 一个包含三个数字的数组\r\n * @returns [max,min]\r\n */\n\nfunction max_min_of_three([a, b, c]) {\n  if (a > b) {\n    if (b > c) {\n      //abc\n      return [a, c];\n    } else {\n      if (a > c) {\n        //acb\n        return [a, b];\n      } else {\n        //cab\n        return [c, b];\n      }\n    }\n  } else {\n    //a<b\n    if (b > c) {\n      if (c > a) {\n        //bca\n        return [b, a];\n      } else {\n        //bac\n        return [b, c];\n      }\n    } else {\n      //cba\n      return [c, a];\n    }\n  }\n}\n\nfunction kmeans(data, k, attempt, thresold = 1) {\n  const cluster_sum\n  /*[r,g,b,a,c]*/\n  = [];\n  let cluster_centers = [];\n  let new_cluster_centers = [];\n  let iteration = 0;\n\n  for (let i = 0; i < k; i++) {\n    const start = Math.floor(Math.random() * data.length);\n    cluster_centers.push(Array.from(data.slice(start, start + 4))); //随机选点\n\n    new_cluster_centers.push(_filled_array(0, 4));\n    cluster_sum.push(_filled_array(0, 5));\n  }\n\n  while (iteration < attempt) {\n    //准备坐标和\n    //计算每个点与中心的距离\n    for (let i = 0; i < data.length;) {\n      let cluster_index = 0;\n\n      let _min_distance = euclidean_distance_squared_index(data, i, cluster_centers[0]);\n\n      for (let j = 1; j < k; j++) {\n        const distance = euclidean_distance_squared_index(data, i, cluster_centers[j]);\n\n        if (distance < _min_distance) {\n          _min_distance = distance;\n          cluster_index = j;\n        }\n      }\n\n      const sum = cluster_sum[cluster_index];\n      sum[0] += data[i++];\n      sum[1] += data[i++];\n      sum[2] += data[i++];\n      sum[3] += data[i++];\n      sum[4]++;\n    }\n\n    let diff = 0; //重新计算中心点\n\n    for (let i = 0; i < k; i++) {\n      const rgbac = cluster_sum[i];\n      const count = rgbac[4];\n\n      if (count == 0) {\n        //空类 重新选中心点\n        const start = Math.floor(Math.random() * data.length);\n        new_cluster_centers[i] = Array.from(data.slice(start, start + 4));\n        diff += thresold;\n      } else {\n        const new_center = new_cluster_centers[i];\n\n        for (let j = 0; j < 4; j++) {\n          new_center[j] = rgbac[j] / count;\n        }\n\n        diff += Math.sqrt(euclidean_distance_squared(cluster_centers[i], new_cluster_centers[i]));\n      }\n    }\n\n    if (diff <= thresold) {\n      return {\n        centroid: new_cluster_centers,\n        iteration,\n        fit: true,\n        label: cluster_sum.map(v => v[4]),\n        size: data.length\n      };\n    }\n\n    const medium = cluster_centers;\n    cluster_centers = new_cluster_centers;\n    new_cluster_centers = medium;\n    iteration++; //清空累加\n\n    for (let i = 0; i < k; i++) {\n      const sum_array = cluster_sum[i];\n      sum_array[0] = 0;\n      sum_array[1] = 0;\n      sum_array[2] = 0;\n      sum_array[3] = 0;\n      sum_array[4] = 0;\n    }\n  }\n\n  return {\n    centroid: cluster_centers,\n    iteration,\n    fit: false,\n    label: cluster_sum.map(v => v[4]),\n    size: data.length\n  };\n}\n\nfunction _filled_array(fillWith, count) {\n  const array = [];\n\n  for (let i = 0; i < count; i++) {\n    array.push(fillWith);\n  }\n\n  return array;\n}\n\nfunction rgba2Rgb(data) {\n  const rgb = new Uint8ClampedArray(data.length / 4 * 3);\n  const len = data.length;\n  let rgb_i = 0;\n\n  for (let i = 0; i < len;) {\n    for (let j = 0; j < 3; j++) {\n      rgb[rgb_i++] = data[i++];\n    }\n\n    i++;\n  }\n\n  return rgb;\n}\n/**\r\n * @param samplefac Sampling factor, which can be changed to increase or decrease quality at the expense of performance. The lower the number, the higher the quality.\r\n * based on 'neuquant-js'\r\n */\n\n\nfunction neuquant(img, k, samplefac = 1) {\n  const img_rgb = rgba2Rgb(img);\n  const palette$1 = palette(img_rgb, {\n    netsize: k,\n    samplefac\n  });\n  const indexed_pixel = indexed(img_rgb, palette$1);\n  const pixel = [];\n  const len = palette$1.length;\n\n  for (let i = 0; i < len;) {\n    pixel.push([palette$1[i++], palette$1[i++], palette$1[i++], 255]);\n  }\n\n  return {\n    centroid: pixel,\n    label: count(k, indexed_pixel)\n  };\n}\n\nfunction count(k, index) {\n  const counts = new Array(k).fill(0);\n\n  for (const i of index) {\n    counts[i]++;\n  }\n\n  return counts;\n}\n\nfunction _prepare2DContext(width, height) {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d'); //contextType 是存在的\n\n  canvas.height = height;\n  canvas.width = width;\n  return ctx;\n}\n/**\r\n * Use OffscreenCanvas\r\n */\n\n\nfunction _prepare2DContextAsync(width, height) {\n  const canvas = new OffscreenCanvas(width, height);\n  const ctx = canvas.getContext('2d');\n  return ctx;\n}\n/**\r\n * a Promise resolved when <img> is loaded\r\n * @param imgElement\r\n * @returns Event, undefined when Image is already loaded\r\n */\n\n\nfunction awaitImage(imgElement) {\n  return new Promise((resolve, reject) => {\n    if (imgElement.complete) {\n      resolve();\n    } else {\n      imgElement.addEventListener('load', e => {\n        resolve(e);\n      });\n      imgElement.addEventListener('error', reason => {\n        reject(reason);\n      });\n    }\n  });\n}\nconst readImage = _readImage.bind(undefined, _prepare2DContext);\n/**\r\n * read image using OffscreenCanvas\r\n */\n\nconst readImageOffscreen = _readImage.bind(undefined, _prepare2DContextAsync);\n\nfunction _readImage(prepareCtx, imgSource) {\n  const {\n    naturalWidth,\n    naturalHeight\n  } = imgSource;\n  const ctx = prepareCtx(naturalWidth, naturalHeight);\n  ctx.drawImage(imgSource, 0, 0, naturalWidth, naturalHeight);\n  return ctx.getImageData(0, 0, naturalWidth, naturalHeight);\n}\n/**\r\n * 降采样后读取图片\r\n * @param imgSource\r\n * @param maxSample\r\n * @returns\r\n */\n\n\nconst readImageDownsampling = _readImageDownsampling.bind(undefined, _prepare2DContext);\nconst readImageDownsamplingOffscreen = _readImageDownsampling.bind(undefined, _prepare2DContextAsync);\n\nfunction _readImageDownsampling(prepareCtx, imgSource, maxSample) {\n  const {\n    naturalWidth: width,\n    naturalHeight: height\n  } = imgSource;\n  const scale = width * height / maxSample;\n\n  if (scale > 1) {\n    const n_width = width / Math.sqrt(scale);\n    const n_height = height / Math.sqrt(scale);\n    const ctx = prepareCtx(n_width, n_height);\n    ctx.drawImage(imgSource, 0, 0, n_width, n_height);\n    return ctx.getImageData(0, 0, n_width, n_height);\n  } else {\n    const ctx = prepareCtx(width, height);\n    ctx.drawImage(imgSource, 0, 0);\n    return ctx.getImageData(0, 0, width, height);\n  }\n}\n\nfunction normalizeRGBA(rgba) {\n  return rgba.map(v => v / 255);\n}\nfunction rgbaToHSLA(rgba) {\n  let h, s; //@ts-ignore\n\n  const [max, min] = max_min_of_three(rgba);\n  const diff = max - min;\n  const light_2x = max + min; //h\n\n  if (diff == 0) {\n    h = 0;\n    s = 0;\n  } else {\n    if (max == rgba[0]) {\n      const temp_h = 60 * (rgba[1] - rgba[2]) / diff;\n\n      if (temp_h < 0) {\n        h = temp_h + 360;\n      } else {\n        h = temp_h;\n      }\n    } else if (max == rgba[1]) {\n      h = 60 * (rgba[2] - rgba[0]) / diff + 120;\n    } else {\n      h = 60 * (rgba[0] - rgba[1]) / diff + 240;\n    }\n\n    if (light_2x == 0) {\n      s = 0;\n    } else if (light_2x <= 1) {\n      s = diff / light_2x;\n    } else {\n      s = diff / (2 - light_2x);\n    }\n  }\n\n  return [h, s, light_2x / 2, rgba[3]];\n}\n/**\r\n * 返回一个排序HSLA颜色的函数\r\n * @param sort\r\n * @returns\r\n */\n\n\nconst getHSLAComparer = (sort = [0, 1, 2, 3]) => (a, b) => {\n  let result;\n\n  for (const s of sort) {\n    result = a[s] - b[s];\n\n    if (result != 0) {\n      return result;\n    }\n  } //其实是赋了值的，但是ts没猜出来\n  //@ts-ignore\n\n\n  return result;\n};\n/**\r\n * 将颜色转换成对应的CSS文本\r\n * @param param0 像素\r\n * @returns hsla(${h}deg,${s}%,${l}%,${a})\r\n */\n\nconst hslaCSSText = ([h, s, l, a]) => `hsla(${h}deg,${s * 100}%,${l * 100}%,${a})`;\n/**\r\n * 将颜色转换成对应的CSS文本\r\n * @param pixel 像素\r\n * @returns rgba(r,g,b,a)\r\n */\n\nconst rgbaCSSText = pixel => `rgba(${pixel.map(v => Math.floor(v)).join(',')})`;\n\nfunction convertToLab(source) {\n  //CIE Lab包含浮点表示，不能使用Uint8ClampedArray\n  const array = [];\n\n  for (let i = 0; i < source.length; i += 4) {\n    const pixel = source.slice(i, i + 4);\n    const alpha = pixel[3];\n    const pixel_rgb = pixel.slice(0, 3);\n    const pixel_xyz = rgb.xyz(pixel_rgb);\n    const pixel_lab = xyz.lab(pixel_xyz);\n    array.push(...pixel_lab, alpha);\n  }\n\n  return array;\n}\nfunction labaToRGBA(laba) {\n  const pixel_lab = laba.slice(0, 3);\n  const alpha = laba[3];\n  const pixel_xyz = lab.xyz(pixel_lab);\n  const pixel_rgb = xyz.rgb(pixel_xyz);\n  pixel_rgb.push(alpha);\n  return pixel_rgb;\n}\n\nexport { awaitImage, convertToLab, getHSLAComparer, hslaCSSText, kmeans, labaToRGBA, neuquant, normalizeRGBA, readImage, readImageDownsampling, readImageDownsamplingOffscreen, readImageOffscreen, rgbaCSSText, rgbaToHSLA };\n//# sourceMappingURL=index.modern.js.map\n","import { neuquant } from \"@kotorik/palette\";\nimport registerPromiseWorker from 'promise-worker/register';\nregisterPromiseWorker((data) => {\n    const { img, k } = data;\n    const result = neuquant(img.data, k);\n    return result;\n});\n","'use strict'\n\nfunction isPromise (obj) {\n  // via https://unpkg.com/is-promise@2.1.0/index.js\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n}\n\nfunction registerPromiseWorker (callback) {\n  function postOutgoingMessage (e, messageId, error, result) {\n    function postMessage (msg) {\n      /* istanbul ignore if */\n      if (typeof self.postMessage !== 'function') { // service worker\n        e.ports[0].postMessage(msg)\n      } else { // web worker\n        self.postMessage(msg)\n      }\n    }\n    if (error) {\n      /* istanbul ignore else */\n      if (typeof console !== 'undefined' && 'error' in console) {\n        // This is to make errors easier to debug. I think it's important\n        // enough to just leave here without giving the user an option\n        // to silence it.\n        console.error('Worker caught an error:', error)\n      }\n      postMessage([messageId, {\n        message: error.message\n      }])\n    } else {\n      postMessage([messageId, null, result])\n    }\n  }\n\n  function tryCatchFunc (callback, message) {\n    try {\n      return { res: callback(message) }\n    } catch (e) {\n      return { err: e }\n    }\n  }\n\n  function handleIncomingMessage (e, callback, messageId, message) {\n    var result = tryCatchFunc(callback, message)\n\n    if (result.err) {\n      postOutgoingMessage(e, messageId, result.err)\n    } else if (!isPromise(result.res)) {\n      postOutgoingMessage(e, messageId, null, result.res)\n    } else {\n      result.res.then(function (finalResult) {\n        postOutgoingMessage(e, messageId, null, finalResult)\n      }, function (finalError) {\n        postOutgoingMessage(e, messageId, finalError)\n      })\n    }\n  }\n\n  function onIncomingMessage (e) {\n    var payload = e.data\n    if (!Array.isArray(payload) || payload.length !== 2) {\n      // message doens't match communication format; ignore\n      return\n    }\n    var messageId = payload[0]\n    var message = payload[1]\n\n    if (typeof callback !== 'function') {\n      postOutgoingMessage(e, messageId, new Error(\n        'Please pass a function into register().'))\n    } else {\n      handleIncomingMessage(e, callback, messageId, message)\n    }\n  }\n\n  self.addEventListener('message', onIncomingMessage)\n}\n\nmodule.exports = registerPromiseWorker\n","import NeuQuant from './neuquant.js'\n\nfunction findClosest (palette, r, g, b) {\n  let minpos = 0\n  let mind = 256 * 256 * 256\n\n  for (let i = 0, l = palette.length; i < l;) {\n    const dr = r - palette[i++]\n    const dg = g - palette[i++]\n    const db = b - palette[i]\n    const d = dr * dr + dg * dg + db * db\n    const pos = i / 3 | 0\n\n    if (d < mind) {\n      mind = d\n      minpos = pos\n    }\n\n    i++\n  }\n\n  return minpos\n}\n\nexport function palette (pixels, options) {\n  const nq = new NeuQuant(pixels, options)\n  nq.buildColorMap()\n  return nq.getColorMap()\n}\n\nexport function indexed (pixels, palette) {\n  const indexed = new Uint8Array(pixels.length / 3)\n  const memo = {}\n\n  for (let i = 0, j = 0, l = pixels.length; i < l;) {\n    const r = pixels[i++]\n    const g = pixels[i++]\n    const b = pixels[i++]\n    const k = r << 16 | g << 8 | b\n\n    if (k in memo) {\n      indexed[j++] = memo[k]\n    } else {\n      indexed[j++] = memo[k] = findClosest(palette, r, g, b)\n    }\n  }\n\n  return indexed\n}\n\nexport function quantize (pixels, options) {\n  const p = palette(pixels, options)\n  const i = indexed(pixels, p)\n\n  return {\n    palette: p,\n    indexed: i\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [4949,1176], () => (__webpack_require__(5905)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t956: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = globalThis[\"webpackChunksakurairo_scripts\"] = globalThis[\"webpackChunksakurairo_scripts\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["deferred","next","img","k","samplefac","img_rgb","data","rgb","Uint8ClampedArray","length","len","rgb_i","i","j","rgba2Rgb","palette$1","netsize","indexed_pixel","pixel","push","centroid","label","count","index","counts","Array","fill","_prepare2DContext","width","height","canvas","document","createElement","ctx","getContext","_prepare2DContextAsync","OffscreenCanvas","_readImage","bind","undefined","prepareCtx","imgSource","naturalWidth","naturalHeight","drawImage","getImageData","_readImageDownsampling","maxSample","scale","n_width","Math","sqrt","n_height","registerPromiseWorker","neuquant","module","exports","callback","postOutgoingMessage","e","messageId","error","result","postMessage","msg","self","ports","console","message","addEventListener","payload","isArray","Error","obj","res","err","tryCatchFunc","then","finalResult","finalError","handleIncomingMessage","findClosest","palette","r","g","b","minpos","mind","l","dr","dg","db","d","pixels","options","nq","buildColorMap","getColorMap","indexed","Uint8Array","memo","quantize","p","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","m","x","__webpack_exports__","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","Object","keys","every","key","splice","n","getter","__esModule","a","definition","o","defineProperty","enumerable","get","f","chunkId","Promise","all","reduce","promises","u","miniCssF","globalThis","this","Function","window","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","currentScript","tagName","toUpperCase","src","scripts","getElementsByTagName","test","replace","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","moreModules","runtime","pop"],"sourceRoot":""}